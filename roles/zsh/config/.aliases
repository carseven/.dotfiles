# zsh
alias update="exec zsh"
alias time_zsh="time zsh -i -c exit"

# Navigation
alias ...="cd ../.."
alias ..="cd ../"
if type lsd &> /dev/null; then
  alias ls="lsd --group-dirs=first"
fi
alias ll="ls -lh"
alias lsa="ls -a"
alias lla="ls -lha"
alias tree="ls -a --tree"

# Bat
if type bat &> /dev/null; then
  alias cat="bat"
  alias catnl="bat --paging=never"
fi

# Editors
alias c="code ."
if type nvim &> /dev/null; then
  alias vim="nvim"
fi

# GO
function go_update_last() {
  # Get last version
  go_lastest_version=$(curl -s https://go.dev/VERSION\?m\=text | head -n 1)

  # Check if go is installed.
  # If it is installed, check if it is the latest version.
  if ! command -v go &> /dev/null; then
    echo "Go is not installed"
  else
    current_go_version=$(go version | awk '{print $3}')
    echo "Go installed version: $current_go_version"
    if [[ "$current_go_version" == "$go_lastest_version" ]]; then
      echo "You are already using the latest version of Go"
      return
    fi
  fi


  # Download the latest version of Go
  go_download_url="https://dl.google.com/go/$go_lastest_version.linux-amd64.tar.gz"
  echo "Downloading go version $go_lastest_version from $go_download_url"
  wget $go_download_url -O /tmp/go.tar.gz

  # Remove old version
  if [[ -d "/usr/local/go" ]]; then
    echo "Removing old version of Go"
    sudo rm -rf /usr/local/go
  fi

  # Install new version
  echo "Installing Go version $go_lastest_version"
  sudo tar -C /usr/local -xzf /tmp/go.tar.gz

  # Remove downloaded file
  echo "Removing downloaded tar file"
  rm /tmp/go.tar.gz

  echo "Go version $go_lastest_version installed!"
}

function go_remove_version() {
  sudo rm -rf /usr/local/go
}

# Node package manager
alias ncomplex="npx code-complexity . --filter '**/*.ts' --limit 10 --sort score"
alias rmnode="find . -name 'node_modules' -type d -prune -print -exec rm -rf '{}' \;"
alias npkill="npx npkill"

# All packages
function p() {
  if [[ -f bun.lockb ]]; then
    command bun "$@"
  elif [[ -f yarn.lock ]]; then
    command yarn $@
  elif [[ -f package-lock.json ]]; then
    command npm $@
  elif [[ -f pnpm-lock.yaml ]]; then
    command pnpm $@
  else
    command npm $@
  fi
}

# System utilities
alias myip="curl http://ipecho.net/plain; echo"
alias usage="du -h -d1"

# GIT
alias gc="git commit -m"
alias gs="git status"
alias gss='git status --short'
alias gd="git diff"
alias ga="git add"
alias gaa="git add ."
alias gf="git fetch --all"
function gdiff() { git diff --name-only --diff-filter=d | xargs bat --diff }
alias gpush="git push"
alias gpushup="git push --set-upstream origin HEAD"
alias gpull="git pull"
alias greset="git reset HEAD~" # reset last commit
alias gw="git switch"
alias gwc="git switch -c"
alias gswitch="git branch | fzf | xargs -I_ git switch _"
alias gbranchdel="git branch | fzf | xargs -I_ git branch -d _"
alias glog='git log --graph --oneline --decorate --all'
alias gg='lazygit'
alias gsearch="git log --decorate --all --oneline -S"
alias gpipe="  git commit --allow-empty -m 'Trigger CI/CD'"

# Docker
alias dstop="docker ps | fzf --header-lines 1 | awk '{print \$1}' | xargs -I_ docker stop _"

# FZF
# Open in vscode dev repositories
alias dev="lsa ~/dev | fzf | xargs -I_ code ~/dev/_"
alias most_used="history  | awk '{print $2}' | sort | uniq -c | sort"
alias killport="lsof -ti:$1 | xargs kill -9"

# Preview files with bat
function preview() {
        if [ "$1" = "h" ]; then
                fzf -m --reverse --preview-window down:20 --preview '[[ $(file --mime {}) =~ binary ]] &&
                        echo {} is a binary file ||
                         (bat --style=numbers --color=always {} ||
                          highlight -O ansi -l {} ||
                          coderay {} ||
                          rougify {} ||
                          cat {}) 2> /dev/null | head -500'
 
        else
                fzf -m --preview '[[ $(file --mime {}) =~ binary ]] &&
                                 echo {} is a binary file ||
                                 (bat --style=numbers --color=always {} ||
                                  highlight -O ansi -l {} ||
                                  coderay {} ||
                                  rougify {} ||
                                  cat {}) 2> /dev/null | head -500'
        fi
}

# Set man colors
function man() {
    env \
    LESS_TERMCAP_mb=$'\e[01;31m' \
    LESS_TERMCAP_md=$'\e[01;31m' \
    LESS_TERMCAP_me=$'\e[0m' \
    LESS_TERMCAP_se=$'\e[0m' \
    LESS_TERMCAP_so=$'\e[01;44;33m' \
    LESS_TERMCAP_ue=$'\e[0m' \
    LESS_TERMCAP_us=$'\e[01;32m' \
    man "$@"
}

function addToPath() {
    if [[ "$PATH" != *"$1"* ]]; then
        export PATH=$PATH:$1
    fi
}

function addToPathFront() {
    if [[ "$PATH" != *"$1"* ]]; then
        export PATH=$1:$PATH
    fi
}